<!DOCTYPE html>
<html>
<head>
  <!-- Load style sheets -->
  <link rel="stylesheet" href="mainLayout.css" />

  <!-- Load any supplemental Javascript libraries here -->
  <script type="text/javascript" src="jquery-1.12.2.js"></script>
  <script src="lodash.js"></script>
  <script type="text/javascript" src="classroom.js"></script>
  <script type="text/javascript">

  var toggleButtonText= function() {
    var currentText = $('#preferenceButton').text();
    if (currentText === 'S h o w    P r e f e r e n c e s') {
      $('#preferenceButton').text('H i d e    P r e f e r e n c e s');
    }
    else {
      $('#preferenceButton').text('S h o w    P r e f e r e n c e s');
    }
  };

  var toggleView = function() {
    if ($('#studentTextBox').is(":visible")) {
      $('#studentTextBox').hide();
      $('#prefTable').show();
    }
    else {
      $('#prefTable').hide();
      $('#studentTextBox').show();
    }
  };

  var parseStudentList = function() {
    var student_list = $("#studentTextBox").val();
    var student_array = student_list.split(",");
    for (var i = 0; i < student_array.length; i++) {
      var s = student_array[i].trim();
      if (classroom.findStudentNamed(s) == null) {
        if (s != "") {
          classroom.addStudent({name: student_array[i].trim(), avoid:[], prefer: []});
        }
      }
    }
  };

  function loadTable(tableId, fields, data) {
    //$('#' + tableId).empty(); //not really necessary
    $('prefTable').empty();
    var rows = "<tr><th>Remove?</th><th>Student</th><th>Pair</th><th>Don't Pair</th></tr>";

    for (student_index in data) {
        var row = "<tr><td><button class = 'remove' id='"+student_index+ "'></button></td>";
        for (field in fields) {


            row += '<td>' + data[student_index][fields[field]] + '</td>';

        }
        rows += row + '<tr>';

    }
    rows += "<tr><td></td><td><input type='text' class = 'add' placeholder='enter new student'></td><td></td><td></td></tr>";
    $('#' + tableId).html(rows);
}


  $(document).ready(function() {
    $('#prefTable').hide();

    classroom = new Classroom();
    //classroom.addStudent({name: "Amy", avoid: ["Susan", "Pat"], prefer: []});
    //classroom.addStudent({name: "Bob", avoid: [], prefer: []});
    //classroom.addStudent({name: "Carol", avoid: [], prefer: []});

    loadTable("prefTable", ["name", "avoid", "prefer"], classroom.studentList);    

    $("#preferenceButton").click(function(e) {
      toggleView();
      toggleButtonText();
  });

    $(document).on('click', ".remove", function(e) {
      console.log('removal detected');
      var student_id = $(this).attr('id');
      console.log(student_id);
      classroom.removeStudent(student_id);
    });

    $(document).on('keyup', ".add", function(e) {
      if (e.which == 13) {
        var new_student = $(".add").val();
        classroom.addStudent({name: new_student, avoid:[], prefer:[]});
      }
    });

    $(document).on('click', "#groupem", parseStudentList());

    $(document).on('click', "#preferenceButton", function() {
      if ($('#prefTable').is(":visible")) {
        parseStudentList();
      }
    });

    $(classroom).on('changestudents', function() {
      loadTable("prefTable", ["name", "avoid", "prefer"], classroom.studentList);
  });



//comma separated names --> if in textmode and press groupem it runs the parse
// if in textmode and press show preferences it runs the parse


});

</script>
</head>




<body>
<h1>Student List</h1>
<textarea id="studentTextBox" placeholder="Type names of students (separate with Enter) or copy-paste" rows="25" cols="75"></textarea>

<button id="preferenceButton">S h o w    P r e f e r e n c e s</button>

<table id="prefTable"></table>

<button id="groupem">Group'em!</button>
</body>
</html>
