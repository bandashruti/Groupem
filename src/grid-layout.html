<script src="https://code.jquery.com/jquery-2.2.3.js" integrity="sha256-laXWtGydpwqJ8JA+X9x2miwmaiKhn8tVmOVEigRNtP4=" crossorigin="anonymous"></script>
<script src="lodash.js"></script>
<script type="text/javascript" src="jquery-1.12.2.js"></script>
<script type="text/javascript" src="classroom.js"></script>
<link href='https://fonts.googleapis.com/css?family=Cabin:400,700' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.0/css/font-awesome.min.css">

<style>
body, html {
  font: 28px Cabin;
  width: 100%;
  height: 100%;
}
table {
    margin: auto;
    width: 60%;
    border-collapse: collapse;
}
table td.student_name {
    width: 20%;
}
table td {
    width: 38%;
    vertical-align: top;
    border: 1px solid gray;
    padding: 2px 2px;
}
table th {
    font-weight: normal;
    font-size: 22px;
}

table td.remove {
    width: 4%;
    vertical-align: middle;
    text-align: center;
}

table td.remove:before {
    font-family: FontAwesome;
    content: '\f014';
}

table td p {
    display: inline-block;
    border: 1px solid;
    border-radius: 5px;
    padding: 3px 7px;
    margin: 1px 3px;
}

table td p span:after {
    font-family: FontAwesome;
    content: ' \f00d';
}

table td p span:hover {
    color: red;
}

table td input {
    width: 100%;
    font: 18px Cabin;
}
</style>
<body>
    <table class="classroom">
      <thead>
        <tr>
            <th>Student</th><th>Pair With</th><th>Don't Pair With</th><th></th>
        </tr>
      </thead>
      <tbody>
      </tbody>

    </table>
</body>
<script>

/**
var studentNames = ["Berk Ustun", "Nick M.", "David Bau", 
                    "Frederick", "George W.", "Shruti", 
                    "Rita", "Wendy", "Jenna", "Alice",
                    "Xin", "Will", "D'Angelo", "Kobe"]
                    
function sampleName(){
    return _.sample(studentNames)
}

function samplePreferences(nSamples){
    if (nSamples == null){
        var nSamples = Math.min(Math.floor(Math.random()*studentNames.length), 2);
    }
    return _.sampleSize(studentNames, nSamples);
}
**/

  var parseStudentList = function() {
    var student_list = $("#newstudentbox").val();
    student_list = student_list.replace(/\n/g, ',');
    student_list = student_list.replace(/;/g, ',');
    var student_array = student_list.split(",");
    for (var i = 0; i < student_array.length; i++) {
      var s = student_array[i].trim();
      if (classroom.findStudentNamed(student_array[i].trim()) == null) {
        if (s != "") {
            console.log('adding');
          classroom.addStudent({name: student_array[i].trim(), avoid:["tod"], prefer: ["amy","carol"]});
        }
      }
    }
  };

var loadTable = function(classroom) {
    $('table tbody').empty()
    for (var i = 0; i < classroom.getStudentCount(); i++) {
        addRow(classroom.getStudent(i));
    }
    addLastRow();
    $("#newstudentbox").focus();
}

function addRow(student) {
    var row = $('<tr>');
    $('<td class="student_name">').appendTo(row).html('<p>' + student.name +'</p>')

    var preferhtml = ""
    for (i = 0; i < student.prefer.length; i++) {
        preferhtml += '<p>' + student.prefer[i] + '<span class="removeprefer" id="'+student.prefer[i]+"*#95f%:"+student.sid+'"></span></p>'
    }


    var avoidhtml = ""
    for (i = 0; i < student.avoid.length; i++) {
        console.log(student.avoid[i]);
        console.log(student.sid);
        avoidhtml += '<p>' + student.avoid[i] + '<span class="removeavoid" id="'+student.avoid[i]+"*#95f%:"+student.sid+'"></span></p>'
    }

    $('<td class="pair_with">').appendTo(row).html(preferhtml);
    $('<td class="dont_pair_with">').appendTo(row).html(avoidhtml);

/**
    $('<td class="pair_with">').appendTo(row).html(
        samplePreferences().map(function(student.prefer) { return '<p>' + student.prefer + '<span></span></p>'; }).join(' ')
    );

    $('<td class="dont_pair_with">').appendTo(row).html(
        samplePreferences().map(function(student.avoid) { return '<p>' + student.avoid + '<span></span></p>'; }).join(' ')
    );
**/

    $('<td id="'+student.sid+'" class="remove">').appendTo(row);
    $('table tbody').append(row);
}

function addLastRow() {
    var row = $('<tr>');
    $('<td class="student_name" colspan="4">').appendTo(row).html('<input id= "newstudentbox" placeholder="Enter new student names">');
    $('table tbody').append(row);
}



$(document).ready(function() {

    classroom = new Classroom();

    loadTable(classroom);    

        /**
    classroom.addStudent({name: "Amy", avoid: ["Susan", "Pat"], prefer: []});
    classroom.addStudent({name: "Bob", avoid: ["Susan", "Pat"], prefer: ["Amy"]});
**/
    $("#preferenceButton").click(function(e) {
      toggleView();
      toggleButtonText();
  });

    $(document).on('click', ".remove", function(e) {
      console.log('removal detected');
      var student_id = $(this).attr('id');
      console.log(student_id);
      classroom.removeStudent(student_id);
    });

    $(document).on('click', ".removeprefer", function(e) {
        var removedata = $(this).attr('id').split("*#95f%:");
        var sid = removedata[1];
        var removal_name = removedata[0];
        for (var  i = 0; i < classroom.getStudentCount(); i++){
            if (classroom.getStudent(i).sid == sid) {
                for (var j = 0; j < classroom.getStudent(i).prefer.length; j++) {
                    if (classroom.getStudent(i).prefer[j] == removal_name ){
                        classroom.getStudent(i).prefer.splice(j, 1);
                        loadTable(classroom);
                    }
                }
            }
        }
    });

    $(document).on('click', ".removeavoid", function(e) {
        var removedata = $(this).attr('id').split("*#95f%:");
        var sid = removedata[1];
        var removal_name = removedata[0];
        for (var  i = 0; i < classroom.getStudentCount(); i++){
            if (classroom.getStudent(i).sid == sid) {
                for (var j = 0; j < classroom.getStudent(i).avoid.length; j++) {
                    if (classroom.getStudent(i).avoid[j] == removal_name ){
                        classroom.getStudent(i).avoid.splice(j, 1);
                        loadTable(classroom);
                    }
                }
            }
        }
    });

    //$(document).on('click', "#groupem", parseStudentList());

    $(document).on('keyup', "#newstudentbox", function(e) {
      if (e.which == 13) {
        parseStudentList();
        $("#newstudentbox").val("");
      }
    })

    $(classroom).on('changestudents', function() {
        console.log('loading');
      loadTable(classroom);
  });

});
</script>
