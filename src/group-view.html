<!DOCTYPE html>
<html>

<meta charset='utf-8'>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="styles.css">
<link href='https://fonts.googleapis.com/css?family=Cabin:400,700' rel='stylesheet' type='text/css'>
<link rel='stylesheet' href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.0/css/font-awesome.min.css">
<link rel='stylesheet' href='cluster-layout.css'>

<body>

<svg></svg>

<div class="sidebar">
<div style="position: relative; text-align: center; margin: 20px 0; height:150px; " >
<img src="our_logo.png" width=150 >
<div style="position: absolute; bottom: 15px; left:0 ; right: 0; text-align: center; color: white; font-size: 20px ">group'em</div>
</div>
<div id='cssmenu'>
<ul>
   <li class='last' ><a href='grid-layout.html'><span>Creation</span></a></li>
   <li class='active'><a href='#'><span>Groups</span></a></li>
</ul>
</div>
</div>

<div id = "control_div">
<button id="shuffle_button" type="button">shuffle</button>
</div>

<script src="lodash.js"></script>
<script src="d3.js"></script>
<script src="jquery-1.12.2.js"></script>
<script src="classroom.js"></script>
<script src="student.js"></script>
<script src="group.js"></script>
<script src="grouping.js"></script>
<script src="cluster-layout.js"></script>

<script>

/*
localStorage.stored_classroom contains a JSON string like this:
{
   "studentList": [
     {"name":"Alice","avoid":[],"prefer":[],"sid":0},
     {"name":"Bob","avoid":[],"prefer":[],"sid":1},
     {"name":"Cory","avoid":[],"prefer":[],"sid":2},
     {"name":"Dana","avoid":[],"prefer":[],"sid":3}
   ]
}"
*/
var temp_classroom = JSON.parse(localStorage.getItem('stored_classroom'));
var buildclassroom = function(c) {
  var classroom = new Classroom();
  for (var s = 0; s < c.length; s++) {
    classroom.setStudent(s, c[s]);
  }
  return classroom;
}
var classroom = buildclassroom(temp_classroom.studentList);


// create random pairs of students
var testStudentsPerGroup = 2;
var grouping = new Grouping(classroom, testStudentsPerGroup);

var studentList = classroom.getStudentList();
var assignments = grouping.getGroups();
  var layout = new ClusterLayout('svg');
  // add students
  for (var i = 0; i < studentList.length; i++) {
    var student = studentList[i];
    layout.addNode(student.sid, student.name);
  }
// add groups
for (var i = 0; i < assignments.length; i++) {
  layout.addCluster(assignments[i].getStudentIDs());
}

// add join listener
$(layout).on('join', function(e) {
  console.log('join', e.node, 'to', e.cluster);
  console.log(grouping.toString());
  grouping.assignStudentToGroup(e.node, e.cluster);
  console.log(grouping.toString());
});

$('#shuffle_button').on('click', function(e) {
  var assignments = grouping.shuffle();
  layout.clear()
  // add students
  for (var i = 0; i < studentList.length; i++) {
    var student = studentList[i];
    layout.addNode(student.sid, student.name);
  }
  // add groups
  for (var i = 0; i < assignments.length; i++) {
    console.log(assignments[i].getStudentIDs());
    layout.addCluster(assignments[i].getStudentIDs());
  }
});
</script>

</body>
</html>
