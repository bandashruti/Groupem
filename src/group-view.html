<!DOCTYPE html>
<html>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="main-layout.css">
    <link rel="stylesheet" href="styles.css">
    <link href='https://fonts.googleapis.com/css?family=Cabin:400,700' rel='stylesheet' type='text/css'>
    <link rel='stylesheet' href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.0/css/font-awesome.min.css">
    <link rel='stylesheet' href='cluster-layout.css'>
    <body>

<svg>
<g class="links"></g>
<g class="joins"></g>
<g class="nodes"></g>
</svg>


<div class="sidebar">
<div style="position: relative; text-align: center; margin: 20px 0 " >
<img src="our_logo.png" width=150 >
<div style="position: absolute; bottom: 15px; left:0 ; right: 0; text-align: center; color: white; font-size: 20px ">group'em</div>
</div>
<div id='cssmenu'>
<ul>
   <li class='active' ><a href='#'><span>Creation</span></a></li>
   <li class='last'><a href='#'><span>Groups</span></a></li>
</ul>
</div>
</div>



<div id="control_div">
<button id="shuffle_button" class ="action_button" type="button">
shuffle
</button>
</div>

<script src="lodash.js"></script>
<script src="d3.js"></script>
<script src="jquery-1.12.2.js"></script>
<script src="classroom.js"></script>
<script src="student.js"></script>
<script src="group.js"></script>
<script src="grouping.js"></script>
<script src="cluster-layout.js"></script>

<script>

function assert(b) {
if (!b) throw new Error('failed assertion');
}

//create a randomly generated classroom
var maxTestStudents = 10
var testStudentList = [];
var allStudentNames = ['Berk', 'Nancy', 'David M.', 'David H.', 'Masha', 'Rita', 'Shruti', 'Nick']
for (var n = 1; n < maxTestStudents; n++){
testStudentList.push(new Student(_.sample(allStudentNames), n));
}

var testClassroom = new Classroom();
testClassroom.setStudentList(testStudentList);
var testStudentIDs = testStudentList.map(function(s){return s.id();})

//create random pairs of students
var testStudentsPerGroup = 2;
var grouping = new Grouping(testClassroom, testStudentsPerGroup);


</script>

<script>


var assignments = grouping.getGroups()

var layout = new ClusterLayout('svg');

//add students
for (var i = 0; i < testStudentList.length; i++){
var student = testStudentList[i]
layout.addNode(student.id(), student.name());
}

//add groups
for (var i = 0; i < assignments.length; i++){
console.log(assignments[i].getStudentIDs())
layout.addCluster(assignments[i].getStudentIDs())
}

//add join listener
$(layout).on('join', function(e){
console.log('join', e.node, 'to', e.cluster);
console.log(grouping.toString());
grouping.assignStudentToGroup(e.node, e.cluster)
console.log(grouping.toString());
});




$('#shuffle_button').on('click', function(e){
    console.log('clicked!')

    var assignments = grouping.shuffle();
    layout.clear()

    //add students
for (var i = 0; i < testStudentList.length; i++){
var student = testStudentList[i]
layout.addNode(student.id(), student.name());
}

//add groups
for (var i = 0; i < assignments.length; i++){
console.log(assignments[i].getStudentIDs())
layout.addCluster(assignments[i].getStudentIDs())
}

console.log('clicked!')
});




</script>

</body>
</html>
