<!DOCTYPE html>
<meta charset='utf-8'>
<style>
html, body, body > svg, body > div {
 position: fixed;
 margin:0; padding:0; height:100%; width:100%; overflow:hidden;
}
body > div {
 pointer-events: none;
}
</style>
<body>
<svg>
</svg>
<div>
</div>
<script src='d3.js'></script>
<script>
var datanodes = [{
     name: 'Alice',
   }, {
     name: 'Bob',
   }, {
     name: 'Carol',
   }, {
     name: 'David',
   }];

var datalinks = [{
     source: 0,
     target: 1
   }, {
     source: 2,
     target: 3
   }];

// http://stackoverflow.com/questions/28102089/simple-graph-of-nodes-and-links-without-using-force-layout

var svg = d3.select('svg');
var lines = svg.selectAll('line')
   .data(datalinks)
   .enter()
   .append('line')
   .attr({
      class: 'link',
      fill: 'none',
      stroke: 'silver',
      'stroke-width': 75,
      'stroke-linecap': 'round'
   });


var nodegroups = svg.selectAll('g')
    .data(datanodes)
    .enter()
    .append('g');

nodegroups.append('circle')
    .attr({
      cx: 0, cy: 0, r: 25,
      fill: 'lightyellow',
      stroke: 'gray',
      'stroke-width': 2.5
    });

nodegroups.append('text')
   .attr({
      'alignment-baseline': 'middle',
      'text-anchor': 'middle',
      y: 1
   }).
   style({
      font: '16px Arial'
   })
   .text(function(d) { return d.name; });

var force = d3.layout.force()
    .charge(-300)
    .linkDistance(75)
    .nodes(datanodes).links(datalinks);
resize();

d3.select(window).on('resize', resize);
function resize() {
  force.size([parseFloat(svg.style('width')), parseFloat(svg.style('height'))]);
}

function tick() {
  lines.attr('x1', function(d) { return d.source.x; });
  lines.attr('y1', function(d) { return d.source.y; });
  lines.attr('x2', function(d) { return d.target.x; });
  lines.attr('y2', function(d) { return d.target.y; });
  nodegroups.attr('transform', function(d) {
    return 'translate(' + [d.x, d.y] + ')';
  });
}

force.on('tick', tick);
force.start()
nodegroups.call(force.drag);
var linedrag = d3.behavior.drag().on('dragstart', function(d) {
  d.source.fixed |= 2;
  d.target.fixed |= 2;
}).on('drag', function(d) {
  console.log('dragging', d3.event.dx, d3.event.dy, JSON.stringify(d));
  d.source.px += d3.event.dx;
  d.source.py += d3.event.dy;
  d.target.px += d3.event.dx;
  d.target.py += d3.event.dy;
  force.resume();
}).on('dragend', function(d) {
  delete d.drag;
  d.source.fixed &= ~2;
  d.target.fixed &= ~2;
});
lines.call(linedrag);
</script>


